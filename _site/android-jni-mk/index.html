<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Android JNI—Android.mk详解 - Blog - Leach Chen</title>
	<meta name="description" content="Android JNI—Android.mk详解">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#311e3e">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#311e3e">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#311e3e">
	
	
	
	
	<!-- Google Fonts 1
	<link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">-->
	
	
	
	
	
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">

	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>  
	
	
	<!--百度统计-->
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "https://hm.baidu.com/hm.js?56385150d223d3a72bebe8a0d4a94e19";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
	
	
	
	
	
	
	
	<!--谷歌统计-->
	<!-- Global site tag (gtag.js) - Google Analytics 
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-113644888-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-113644888-1');
	</script>-->

</head>

<body>
  <div class="flex-container">
  <header class="main-header">
  <div class="wrapper">
    <div class="header-flex">
      <div class="menu-icon-container">
        <span class="menu-icon"><i class="fa fa-bars" aria-hidden="true"></i></span>
      </div>
      <nav class="main-nav">
        <span class="menu-icon-close"><i class="fa fa-times" aria-hidden="true"></i></span>
        <ul style="height:800px;overflow-y:scroll;overflow-y:auto;">
		 
			 
			 

			 

			 

			 

			 

       

			 <li><a  href="/"  data-hover="所有">所有(23)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

			 <li><a  href="/blog/essays"  data-hover="随笔">随笔(1)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

			 <li><a  href="/blog/jekyll"  data-hover="Jekyll">Jekyll(1)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

			 <li><a  href="/blog/android"  data-hover="Android">Android(13)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

			 <li><a  href="/blog/abouttest"  data-hover="测试相关">测试相关(3)</a></li>
		 
			 
			 

			 

			 

			 

			 

       

			 <li><a  href="/blog/other"  data-hover="其它">其它(5)</a></li>
		 
          <!--<li style="margin-bottom:200px;"><a href="/about">About(5)</a></li>-->
        </ul>
      </nav>
      <p class="logo"><a href="/">Leach Chen</a></p>


		<div class="navbar-container">

		<div class="search-icon"><a><i class="fa fa-search" aria-hidden="true"></i></a></div>

			<div class="navbar-menu">
			   
				<a href="/"  data-hover="Home">Home</a>  <!--title="访问 Home"-->
				<!--<a href="/">Home</a>-->
					
				<a href="/about"  data-hover="About">About</a>  <!--title="访问 About"-->
				<!--<a href="/about">About</a>-->
					
			</div>


			<div class="navbar-mobile-menu" onclick="">
				<span class="icon-menu cross"><span class="middle"></span></span>
				<ul>
				   
					 <li><a href="/"data-hover="Home">Home</a></li>  <!--title="访问 Home"-->
					 <!--<li><a href="/">Home</a></li>-->
				   
					 <li><a href="/about"data-hover="About">About</a></li>  <!--title="访问 About"-->
					 <!--<li><a href="/about">About</a></li>-->
				   
				</ul>
			</div>



		</div>

    <!--  <div class="search-icon-container">
	    <a href="/" style="text-decoration: none; color: inherit;margin-right:20px;">Home</a>
		<a href="/about" style=" text-decoration: none; color: inherit;margin-right:20px;">About</a>
        <span class="search-icon"><a><i class="fa fa-search" aria-hidden="true"></i></a></span>
      </div> -->


    </div>
  </div>
</header> <!-- End Header -->

  <article class="article-page">
    <div class="page-image">
      <div class="cover-image" style="background: url(/assets/img/post-8.jpg) center no-repeat; background-size: cover;"></div>
    </div>
    <div class="wrapper">
      <div class="page-content">
        <div class="header-page">
          <h1 class="page-title">Android JNI—Android.mk详解</h1>
          <div class="page-date"><time datetime="2018-03-07 17:20:00 +0800">2018, Mar 07</time>
		  <span id="busuanzi_container_page_pv"> | 访问量：<span id="busuanzi_value_page_pv"></span> 次</span>
		  </div>
        </div>
        <p>看一个简单的Android.mk的例子：</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)<br /></p>

  <p>include $(CLEAR_VARS)<br /></p>

  <p>LOCAL_MODULE    := hello-jni<br />
LOCAL_SRC_FILES := hello-jni.c<br /></p>

  <p>include $(BUILD_SHARED_LIBRARY)<br /></p>
</blockquote>

<h2 id="例子说明"><strong>例子说明</strong></h2>
<p><strong>LOCAL_PATH:=$(call my-dir)</strong><br />
Android.mk文件首先必须要指定LOCAL_PATH变量，用于查找源文件。一般情况下Android.mk和需要编译的源文件在同一目录下。上面的语句的意思是将LOCAL_PATH变量定义成本文件所在目录路径。</p>

<p><strong>include $(CLEAR_VARS)</strong><br />
Android.mk中可以定义多个编译模块，每个编译模块都是以include $(CLEAR_VARS)开始，以include $(BUILD_XXX)结束。<br />
CLEAR_VARS由编译系统提供，指定让GNU MAKEFILE为你清除除LOCAL_PATH以外的所有LOCAL_XXX变量，清除它们可以避免冲突，每一个原生组件被称为一个模块。如LOCAL_MODULE，LOCAL_SRC_FILES，LOCAL_SHARED_LIBRARIES，LOCAL_STATIC_LIBRARIES等。</p>

<p><strong>LOCAL_MODULE ：= hello-jni</strong><br />
LOCAL_MODULE模块必须定义，以表示Android.mk中的每一个模块。名字必须唯一且不包含空格。Build System会自动添加适当的前缀和后缀。例如，foo，要产生动态库，则生成libfoo.so. 但请注意：如果模块名被定为：libfoo.则生成libfoo.so. 不再加前缀。</p>

<p><strong>LOCAL_SRC_FILES：= hello-jni.c</strong><br />
LOCAL_SRC_FILES变量必须包含将要打包如模块的C/C++ 源码。不必列出头文件，build System 会自动帮我们找出依赖文件。缺省的C++源码的扩展名为.cpp. 也可以修改，通过LOCAL_CPP_EXTENSION。</p>

<p><strong>include $(BUILD_XXX)</strong><br />
BUILD_XXX是Build System提供的一个变量，指向一个GNU Makefile Script。它负责收集自从上次调用 include $(CLEAR_VARS)后的所有LOCAL_XXX信息。并决定编译为什么。<br />
BUILD_SHARED_LIBRARY：将你列出的Source编译成一个动态库。注意，在包含此文件前，至少应该包含：LOCAL_MODULE and LOCAL_SRC_FILES 。<br />
BUILD_STATIC_LIBRARY：将你列出的Source编译成一个静态库。静态库不能够加入到Project 或者APK中。但它可以用来生成动态库。。<br />
BUILD_EXECUTABLE：编译为Native C可执行程序<br /></p>

<h2 id="变量说明"><strong>变量说明</strong></h2>

<hr />

<p>NDK Build System变量</p>

<p><strong>CLEAR_VARS</strong><br />
指向一个编译脚本。必须在新模块前包含之。</p>
<blockquote>
  <p>include $(CLEAR_VARS)</p>
</blockquote>

<p><strong>BUILD_SHARED_LIBRARY</strong><br />
指向一个编译脚本，它收集自从上次调用 include $(CLEAR_VARS)  后的所有LOCAL_XXX信息。
并决定如何将你列出的Source编译成一个动态库。 注意，在包含此文件前，至少应该包含：LOCAL_MODULE and LOCAL_SRC_FILES 例如：</p>
<blockquote>
  <p>include $(BUILD_SHARED_LIBRARY)</p>
</blockquote>

<p><strong>BUILD_STATIC_LIBRARY</strong><br />
与前面类似，它也指向一个编译脚本，
收集自从上次调用 include $(CLEAR_VARS)  后的所有LOCAL_XXX信息。
并决定如何将你列出的Source编译成一个静态库。 静态库不能够加入到Project 或者APK中。但它可以用来生成动态库。
LOCAL_STATIC_LIBRARIES and LOCAL_WHOLE_STATIC_LIBRARIES将描述之。</p>
<blockquote>
  <p>include $(BUILD_STATIC_LIBRARY)</p>
</blockquote>

<p><strong>BUILD_EXECUTABLE</strong><br />
与前面类似，它也指向一个编译脚本，收集自从上次调用 include $(CLEAR_VARS)  后的所有LOCAL_XXX信息。
并决定如何将你列出的Source编译成一个可执行Native程序。</p>
<blockquote>
  <p>include $(BUILD_EXECUTABLE)</p>
</blockquote>

<p><strong>PREBUILT_SHARED_LIBRARY</strong><br />
把这个共享库声明为 “一个” 独立的模块。
指向一个build 脚本，用来指定一个预先编译好多动态库。 与BUILD_SHARED_LIBRARY and BUILD_STATIC_LIBRARY不同，
此时模块的LOCAL_SRC_FILES应该被指定为一个预先编译好的动态库，而非source file.  LOCAL_PATH := $(call my-dir)</p>

<blockquote>
  <p>include $(CLEAR_VARS)<br />
<br />
LOCAL_MODULE := foo-prebuilt     # 模块名<br />
LOCAL_SRC_FILES := libfoo.so     # 模块的文件路径（相对于 LOCAL_PATH）<br />
<br />
include $(PREBUILT_SHARED_LIBRARY) # 注意这里不是 BUILD_SHARED_LIBRARY<br /></p>
</blockquote>

<p>这个共享库将被拷贝到 $PROJECT/obj/local 和 $PROJECT/libs/<abi> (stripped)  主要是用在将已经编译好的第三方库
使用在本Android Project中。为什么不直接将其COPY到libs/armabi目录呢？因为这样做缺陷很多。下一节再详细说明。</abi></p>

<p><strong>PREBUILT_STATIC_LIBRARY</strong><br />
预先编译的静态库。同上。</p>

<p><strong>TARGET_ARCH</strong><br />
目标ＣＰＵ架构名。如果为“arm” 则声称ARM兼容的指令。与CPU架构版本无关。</p>

<p><strong>TARGET_PLATFORM</strong><br />
目标平台的名字。</p>

<p><strong>TARGET_ARCH_ABI</strong><br />
Name of the target CPU+ABI<br />
armeabi For ARMv5TE  armeabi-v7a</p>

<p><strong>TARGET_ABI</strong><br />
目标平台和 ABI 的组合</p>

<p><br /></p>

<hr />

<p>NDK提供的功能宏<br />
GNU　Make 提供的功能宏，只有通过类似： $(call function)   的方式来得到其值，它将返回文本化的信息。</p>

<p><strong>my-dir: $(call my-dir)</strong><br />
返回最近一次include的Makefile的路径。通常返回Android.mk所在的路径。它用来作为Android.mk的开头来定义LOCAL_PATH.</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)</p>
</blockquote>

<p>请注意：返回的是最近一次include的Makefile的路径。所以在Include其它Makefile后，再调用$(call my-dir)会返回其它Android.mk 所在路径。例如：</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)   … declare one module <br />
include $(LOCAL_PATH)/foo/Android.mk<br />
LOCAL_PATH := $(call my-dir)   … declare another module<br /></p>
</blockquote>

<p>则第二次返回的LOCAL_PATH　为：$PATH/foo。 而非$PATH.</p>

<p><strong>all-subdir-makefiles</strong><br />
返回一个列表，包含’my-dir’中所有子目录中的Android.mk。如结构如下：<br />
sources/foo/Android.mk   sources/foo/lib1/Android.mk   sources/foo/lib2/Android.mk<br />
在If sources/foo/Android.mk 中， include $(call all-subdir-makefiles)  那则自动include 了sources/foo/lib1/Android.mk and sources/foo/lib2/Android.mk。</p>

<p><strong>this-makefile</strong><br />
当前Makefile的路径。</p>

<p><strong>parent-makefile</strong><br />
返回include tree中父Makefile 路径。 也就是include 当前Makefile的Makefile Path。</p>

<p><strong>import-module</strong><br />
允许寻找并inport其它modules到本Android.mk中来。 它会从NDK_MODULE_PATH寻找指定的模块名。<br />
$(call import-module,<name>)</name></p>

<p><br /></p>

<hr />

<p>模块描述变量<br />
此类变量用来给Build System描述模块信息。在’include $(CLEAR_VARS)’ 和 ‘include $(BUILD_XXXXX)’之间。必须定义此类变量。
include $(CLEAR_VARS) script用来清空这些变量。 <br />
include $(BUILD_XXXXX)收集和使用这些变量。</p>

<p><strong>LOCAL_PATH</strong><br />
这个值用来给定当前目录。必须在Android.mk的开是位置定义之。
例如：  LOCAL_PATH := $(call my-dir)   LOCAL_PATH不会被include $(CLEAR_VARS) 清理。</p>

<p><strong>LOCAL_MODULE</strong><br />
modules名。在include $(BUILD_XXXXX)之前，必须定义这个变量。此变量必须唯一且不能有空格。 <br />
通常，由此变量名决定最终生成的目标文件名。</p>

<p><strong>LOCAL_MODULE_FILENAME</strong><br />
可选。用来override LOCAL_MODULE. 即允许用户重新定义最终生成的目标文件名。  <br />
LOCAL_MODULE := foo-version-1  LOCAL_MODULE_FILENAME := libfoo</p>

<p><strong>LOCAL_SRC_FILES</strong><br />
为Build Modules而提供的Source 文件列表。不需要列出依赖文件。 注意：文件相对于LOCAL_PATH存放，
且可以提供相对路径。 例如：<br />
LOCAL_SRC_FILES := foo.c               \ toto/bar.c</p>

<p><strong>LOCAL_CPP_EXTENSION</strong><br />
指出C++ 扩展名。(可选)<br />
LOCAL_CPP_EXTENSION := .cxx 从NDK R7后，可以写多个：<br />
LOCAL_CPP_EXTENSION := .cxx .cpp .cc</p>

<p><strong>LOCAL_CPP_FEATURES</strong><br />
可选。用来指定C++ features。<br />
LOCAL_CPP_FEATURES := rtti<br />
LOCAL_CPP_FEATURES := exceptions</p>

<p><strong>LOCAL_C_INCLUDES</strong><br />
一个可选的path列表。相对于NDK ROOT 目录。编译时，将会把这些目录附上。<br />
LOCAL_C_INCLUDES := sources/foo  LOCAL_C_INCLUDES := $(LOCAL_PATH)/../foo</p>

<p><strong>LOCAL_CFLAGS</strong><br />
一个可选的设置，在编译C/C++ source 时添加如Flags。
用来附加编译选项。 注意：不要尝试在此处修改编译的优化选项和Debug等级。它会通过您Application.mk中的信息自动指定。<br />
也可以指定include 目录通过：LOCAL_CFLAGS += -I<path>。 这个方法比使用LOCAL_C_INCLUDES要好。因为这样也可以被ndk-debug使用。</path></p>

<p><strong>LOCAL_CXXFLAGS</strong><br />
LOCAL_CPPFLAGS的别名。</p>

<p><strong>LOCAL_CPPFLAGS</strong><br />
C++ Source 编译时添加的C Flags。这些Flags将出现在LOCAL_CFLAGS flags 的后面。</p>

<p><strong>LOCAL_STATIC_LIBRARIES</strong><br />
要链接到本模块的静态库list。(built with BUILD_STATIC_LIBRARY)</p>

<p><strong>LOCAL_SHARED_LIBRARIES</strong><br />
要链接到本模块的动态库。</p>

<p><strong>LOCAL_WHOLE_STATIC_LIBRARIES</strong><br />
静态库全链接。 不同于LOCAL_STATIC_LIBRARIES，类似于使用–whole-archive</p>

<p><strong>LOCAL_LDLIBS</strong><br />
linker flags。 可以用它来添加系统库。 如 -lz: <br />
LOCAL_LDLIBS := -lz</p>

<p><strong>LOCAL_ALLOW_UNDEFINED_SYMBOLS</strong><br /></p>

<p><strong>LOCAL_ARM_MODE</strong><br />
缺省模式下，ARM目标代码被编译为thumb模式。每个指令16位。如果指定此变量为：arm。 则指令为32位。<br />
LOCAL_ARM_MODE := arm   其实也可以指定某一个或者某几个文件的ARM指令模式。</p>

<p><strong>LOCAL_ARM_NEON</strong><br />
设置为true时，会讲浮点编译成neon指令。这会极大地加快浮点运算(前提是硬件支持)
只有targeting 为 ‘armeabi-v7a’时才可以。</p>

<p><strong>LOCAL_DISABLE_NO_EXECUTE</strong><br /></p>

<p><strong>LOCAL_EXPORT_CFLAGS</strong><br />
定义这个变量用来记录C/C++编译器标志集合，
并且会被添加到其他任何以LOCAL_STATIC_LIBRARIES和LOCAL_SHARED_LIBRARIES的模块的LOCAL_CFLAGS定义中       <br />
LOCAL_SRC_FILES := foo.c bar.c.arm</p>

<h2 id="applicationmk变量"><strong>Application.mk变量</strong></h2>
<p>用于描述app需要的native model。</p>

<p><strong>APP_PROJECT_PATH</strong><br />
这个变量存储应用程序的项目根目录的绝对路径。</p>

<p><strong>APP_OPTIM</strong><br />
配置release和debug</p>

<p><strong>APP_CFLAGS</strong><br />
这个变量存储一组构建系统的C编译器标志传递给编译器编译任何C或c++源代码的任何模块，可以修改应用需要的构建模块而不用修改Android.mk文件</p>

<p><strong>APP_CPPFLAGS</strong><br />
和 APP_CFLAGS类似</p>

<p><strong>APP_LDFLAGS</strong><br />
 A set of linker flags that the build system passes when linking the application，只对 shared libraries 和 executables有效</p>

<p><strong>APP_BUILD_SCRIPT</strong><br />
指定Android.mk文件</p>

<p><strong>APP_ABI</strong><br />
指定abi</p>

<p><strong>APP_PLATFORM</strong><br />
指定android api版本</p>

<p><strong>APP_STL</strong><br />
链接其他的c＋＋支持</p>

<p><strong>NDK_TOOLCHAIN_VERSION</strong><br />
gcc编译版本</p>

<p><strong>APP_PIE</strong><br /></p>

<p><strong>APP_THIN_ARCHIVE</strong><br /></p>

<h2 id="常用构建系统变量"><strong>常用构建系统变量</strong></h2>
<p><strong>构建共享库</strong><br />
为了建立可供主应用程序使用的模块，必须将该模块变成共享库。Android NDK构建系统将BUILD_STATIC_LIBRARY变量设置成build-shared-library.mk文件的保存位置。</p>
<blockquote>
  <p>include $(BUILD_STATIC_LIBRARY)</p>
</blockquote>

<p><strong>构建多个共享库</strong><br />
基于不同应用程序的体系结构，一个单独的Android.mk文件可能产生多个共享库模块，为了达到这个目的，需要在Android.mk文档中定义多个模块。例如：</p>

<blockquote>
  <p>LOCAL_PATH := $(call my-dir)<br />
<br />
#模块1<br />
<br />
include $(CLEAR_VARS)<br />
LOCAL_MODULE    := hello-jni1<br />
LOCAL_SRC_FILES := hello-jni1.c<br />
<br />
include $(BUILD_SHARED_LIBRARY)<br />
<br />
#模块2<br />
<br />
include $(CLEAR_VARS)<br />
LOCAL_MODULE    := hello-jni2<br />
LOCAL_SRC_FILES := hello-jni2.c<br />
<br />
include $(BUILD_SHARED_LIBRARY)<br /></p>
</blockquote>

<p>在处理完这个Android.mk构建文档之后，Android NDK构建系统会产生libhello-jni1.so和libhello-jni2.so两个共享库。</p>

<p><strong>构建静态库</strong><br />
Android NDK构建系统也支持静态库，静态库可以用来构建共享库，例如，在将第三方代码添加到现有原生项目中，不用直接将第三方源代码包括在原生项目中，而是将第三方代码编译成静态库，然后并入共享库。</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)     <br />
    <br />
#第三方AVI库     <br />
include $(CLEAR_VARS)     <br />
    <br />
LOCAL_MODULE    := avilib     <br />
LOCAL_SRC_FILES := avilib.c     <br />
    <br />
include $(BUILD_SHARED_LIBRARY)     <br />
    <br />
#原生模块     <br />
include $(CLEAR_VARS)     <br />
    <br />
LOCAL_MODULE    := hello-jni     <br />
LOCAL_SRC_FILES := hello-jni.c     <br />
    <br />
LOCAL_SHARED_LIBRARIES：=avilib     <br />
    <br />
include $(BUILD_SHARED_LIBRARY)</p>
</blockquote>

<p>将第三方代码模块生成静态库后，共享库就可以通过将它的模块名称添加到LOCAL_SHARED_LIBRARIES变量中来使用该模块。</p>

<p><strong>用公共库共享通用模块</strong><br />
静态库可以保证源代码模块化，但是，当静态库与共享库相连接时，就变成了共享库的一部分。在多个共享库的情况下，多个共享库与同一个静态库连接时，需要将通用模块的多个副本与不同共享库重复连接，这样就增加了应用程序的大小，在这种情况下，我们不用构建静态库，而是将通用模块作为共享库建立起来，而动态连接依赖模块以便消除重复的副本。</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)     <br />
    <br />
#第三方AVI库     <br />
include $(CLEAR_VARS)     <br />
    <br />
LOCAL_MODULE    := avilib     <br />
LOCAL_SRC_FILES := avilib.c     <br />
include $(BUILD_SHARED_LIBRARY)     <br />
    <br />
#原生模块1     <br />
    <br />
include $(CLEAR_VARS)     <br />
LOCAL_MODULE    := hello-jni1     <br />
LOCAL_SRC_FILES := hello-jni1.c     <br />
LOCAL_SHARED_LIBRARIES：=avilib     <br />
    <br />
include $(BUILD_SHARED_LIBRARY)     <br />
     <br />
#原生模块2     <br />
    <br />
include $(CLEAR_VARS)     <br />
LOCAL_MODULE    := hello-jni2     <br />
LOCAL_SRC_FILES := hello-jni2.c     <br />
LOCAL_SHARED_LIBRARIES：=avilib     <br />
    <br />
include $(BUILD_SHARED_LIBRARY)     <br /></p>
</blockquote>

<p><strong>在多个NDK项目间共享模块</strong><br />
同时使用静态库和共享库时，可以在模块间共享通用模块。但是要注意的是，所有这些模块必须属于同一个NDK项目。<br />
1.首先将avilib源代码移动到当前NDK项目以外的位置，如：D:\shared-moudles\transcode\avilib<br />
2.作为共享模块，avilib需要自己的Android.mk文件，具体配置如下：&lt;br</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)    <br />
   <br />
#第三方AVI库    <br />
include $(CLEAR_VARS)    <br />
   <br />
LOCAL_MODULE    := avilib    <br />
LOCAL_SRC_FILES := avilib.c    <br />
include $(BUILD_SHARED_LIBRARY)    <br /></p>
</blockquote>

<p>3.现在可以将avilib模块从当前NDK项目的Android.mk文件中移除。通常，为了避免冲突，我们将以transcode/avilib为参数调用函数宏import-module不分添加在构建文档的末尾。</p>
<blockquote>
  <p>#原生模块    <br />
include $(CLEAR_VARS)    <br />
   <br />
LOCAL_MODULE    := hello-jni1    <br />
LOCAL_SRC_FILES := hello-jni1.c    <br />
LOCAL_SHARED_LIBRARIES：=avilib    <br />
   <br />
include $(BUILD_SHARED_LIBRARY)    <br />
   <br />
$(call import-module,transcode/avilib)    <br /></p>
</blockquote>

<p>4.import-module函数宏需要先定位共享模块，然后将它导入到NDK项目中。默认情况下，import-module函数宏只搜索/sources目录。为了搜索D:\shared-moudles目录，定义一个名为NDK_MODULE_PATH的新环境变量并将它设置成共享模块的根目录，例如D:\shared-moudles。</p>

<p><strong>用Prebuilt库</strong><br />
prebulit库有两大作用：
1.想在不发布源代码的情况下将你的模块发布给他人
2.想使用共享模块的预建版来加速构建过程</p>
<blockquote>
  <p>LOCAL_PATH := $(call my-dir)<br />
<br />
#第三方AVI库<br />
include $(CLEAR_VARS)<br />
<br />
LOCAL_MODULE    := avilib<br />
LOCAL_SRC_FILES := libavilib.so<br />
include $(PREBUILT_SHARED_LIBRARY)<br /></p>
</blockquote>

<p>其中，LOCAL_SRC_FILES 变量指向的不是源文件，而是实际Prebuild库相对于LOCAL_PATH的位置。</p>

<p><strong>构建独立的可执行文件</strong><br />
有时候为了方便快速测试和原型设计，我们可能会需要Android NDK构建独立的可执行文件，它们不用打包成APK文件既可以赋值到android设备上的常规Linux应用程序，而且它们可以直接执行，而不通过java应用程序加载。生成独立的可以执行文件需要再Android.mk构建文档中导入BUILD_EXECUTABLE变量。</p>
<blockquote>
  <p>#独立可执行的原生模块
include $(CLEAR_VARS)<br />
<br />
LOCAL_MODULE    := moudles<br />
LOCAL_SRC_FILES := moudles.c<br />
LOCAL_SHARED_LIBRARIES：=avilib<br />
<br />
include $(BUILD_EXECUTABLE)<br /></p>
</blockquote>

<p>独立的可执行文件以与模块相同的名称放在libs/目录下。</p>

<p><strong>定义新变量</strong><br />
开发人员可以定义其他新变量来简化他们的构建文件。以LOCAL_和NDK_前缀开头的名称预留给Android NDK构建系统使用，建议大家使用MY_开头。例如：
MY_SRC_FILIES:=avilib.c</p>

<p><strong>条件操作</strong><br />
Android.mk构建文件可以包含某些关于这些变量的条件操作，例如，在某个体系结构中包含一个不同的源文件集：</p>
<blockquote>
  <p>……<br />
ifeq($(TARGET_ARCH),arm)<br /><br />
LOCAL_SRC_FILES += armonly.c<br />
else<br />
LOCAL_SRC_FILES += generic.c<br />
endif<br />
……</p>
</blockquote>

<p><a href="http://blog.csdn.net/zhangcanyan/article/details/51932758" style="text-decoration: none;" target="_blank" title="参考网址">参考网址1</a><br />
 <a href="http://blog.csdn.net/mynameishuangshuai/article/details/52577228" style="text-decoration: none;" target="_blank" title="参考网址">参考网址2</a><br />
 <a href="http://blog.csdn.net/qq_21430549/article/details/53365915" style="text-decoration: none;" target="_blank" title="参考网址">参考网址3</a><br /></p>

        <div class="page-footer">
          <div class="page-tag">
            <span>Tags:</span>
            
            <a href="/tags#Android" class="tag">| Android</a>
            
            <a href="/tags#JNI" class="tag">| JNI</a>
            
          </div><!-- End Tags -->
          <div class="page-share">
            <span>Share:</span>
            <a href="https://twitter.com/intent/tweet?text=Android JNI—Android.mk详解&url=http://localhost:4000/android-jni-mk/" title="Share on Twitter" rel="nofollow" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
            <a href="https://facebook.com/sharer.php?u=http://localhost:4000/android-jni-mk/" title="Share on Facebook" rel="nofollow" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
            <a href="https://plus.google.com/share?url=http://localhost:4000/android-jni-mk/" title="Share on Google+" rel="nofollow" target="_blank"><i class="fa fa-google" aria-hidden="true"></i></a>
						
			<!-- JiaThis Button BEGIN -->
			<div class="jiathis_style_32x32">
				<a class="jiathis_button_weixin"></a>
				<a class="jiathis_button_tsina"></a>
				<!--<a class="jiathis_button_tqq"></a>
				<a class="jiathis_button_qzone"></a>
				<a class="jiathis_button_renren"></a>-->
				<a href="http://www.jiathis.com/share?uid=2157296" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
				<a class="jiathis_counter_style"></a>
			</div>
			<script type="text/javascript">var jiathis_config = {data_track_clickback:'true'};</script>
			<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=2157296" charset="utf-8"></script>
			<!-- JiaThis Button END -->
          </div><!-- End Share -->
		  
		
		  
		  <section>
			<!--<div style="background:#000;border-bottom: 1px solid #d9d9d9;"></div> -->

            <div class="content-play">
              <p><a href="javascript:void(0)" onclick="dashangToggle()" class="dashang" title="打赏，支持一下">打赏一下呗</a></p>
              <div class="hide_box-play"></div>
              <div class="shang_box-play">
                <a class="shang_close-play" href="javascript:void(0)" onclick="dashangToggle()" title="关闭"><img src="/assets/img/close.jpg" alt="取消" /></a>
                <div class="shang_tit-play">
                  <p>对你有帮助，那就打赏一下吧</p>
                </div>
				
				<div class="shang_payimg">    
                    <img src="/assets/img/wechatimg.jpg" alt="扫码支持" title="扫一扫"/>
                </div>
				
				 <div class="pay_item" data-id="weipay">
                    <span class="pay_logo"><img src="/assets/img/wechat.jpg" alt="微信" /></span>
                  </div>
				
                <div class="shang_payimg">
                    <img src="/assets/img/alipayimg.jpg" alt="扫码支持" title="扫一扫" />
                </div>
				
				 <div class="pay_item checked" data-id="alipay">
                    <span class="pay_logo"><img src="/assets/img/alipay.jpg" alt="支付宝" /></span>
                  </div>
				
                <div class="pay_explain">扫码打赏,金额随意</div>
               
              </div>
            </div>
            <script type="text/javascript">
            function dashangToggle(){
              $(".hide_box-play").fadeToggle();
              $(".shang_box-play").fadeToggle();
            }
            </script>

            <div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';"></div>

            <style type="text/css">
              .content-play{width:100%;margin-top: 20px;margin-bottom: 10px;height:40px;text-align:center;}
              .hide_box-play{z-index:999;filter:alpha(opacity=50);background:#666;opacity: 0.5;-moz-opacity: 0.5;left:0;top:0;height:99%;width:100%;position:fixed;display:none;}
              .shang_box-play{width:100%;height:540px;padding:10px;background-color:#fff;border-radius:10px;position:fixed;z-index:1000;left:0%;top:50%;margin-left:0px;margin-top:-280px;border:1px dotted #dedede;display:none;}
              .shang_box-play img{border:none;border-width:0;}
              .dashang{width:100px;margin:5px auto;height:25px;line-height:25px;padding:10px;background-color:#E74851;color:#fff;text-align:center;text-decoration:none;border-radius:10px;font-weight:bold;font-size:16px;transition: all 0.3s;}
              .dashang:hover{opacity:0.8;padding:15px;font-size:18px;}
              .shang_close-play{float:right;display:inline-block;
                margin-right: 10px;margin-top: 20px;
              }
              .shang_logo{display:block;text-align:center;margin:20px auto;}
              .shang_tit-play{width: 100%;height: 75px;text-align: center;line-height: 66px;color: #a3a3a3;font-size: 16px;background: url('/images/payimg/cy-reward-title-bg.jpg');font-family: 'Microsoft YaHei';margin-top: 7px;margin-right:2px;}
              .shang_tit-play p{color:#a3a3a3;text-align:center;font-size:16px;}
              .shang_payimg{padding:10px;/*border:6px solid #EA5F00;**/margin:0 auto;border-radius:3px;height:140px;display:inline-block;}
              .shang_payimg img{display:inline-block;margin-right:10px;float:left;text-align:center;width:140px;height:140px; }
              .pay_explain{text-align:center;margin:10px auto;font-size:12px;color:#545454;}
              .shang_payselect{text-align:center;margin:0 auto;margin-top:40px;cursor:pointer;height:60px;width:500px;margin-left:110px;}
              .shang_payselect .pay_item{display:inline-block;margin-right:140px;float:left;}
              .shang_info-play{clear:both;}
              .shang_info-play p,.shang_info-play a{color:#C3C3C3;text-align:center;font-size:12px;text-decoration:none;line-height:2em;}
            </style>

       <ul class="pager">
	    
        <li class="previous">
            <a href="/android-jni-cmake/" data-toggle="tooltip" data-placement="top" title="Android JNI—CmakeLists详解">上一篇：  <span>Android JNI—CmakeLists详解</span>
            </a>
        </li>
		
		<br><br>
		
        
        
        <li class="next">
            <a href="/android-jni-config/" data-toggle="tooltip" data-placement="top" title="Android JNI—项目配置及用法">下一篇：  <span>Android JNI—项目配置及用法</span>
            </a>
        </li>
        
    </ul>
</section>

        </div>
		
		
        <section class="author-box">
  <img src="/assets/img/leach-face.jpg" alt="Leach Chen" class="author-img">
  <div class="author-desc">
    <h2>Leach Chen</h2>
    <p>I will add description latter.</p>
    <ul>
      
        <li class="email"><a href="mailto:leach.chen@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
      
      
        <li class="phone"><a href="tel:0"><i class="fa fa-phone"></i></a></li>
      
      <!--
        <li class="website"><a href="https://artemsheludko.github.io" target="_blank"><i class="fa fa-globe" aria-hidden="true"></i></a></li>
      
      
        <li class="twitter"><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
      -->
    </ul>
  </div>
</section>

        <div class="recent-box">
  <h2 class="recent-title">Recent post</h2>
  <div class="recent-list">
    
      
        <a href="/3d/" class="recent-item" style="background: url(/assets/img/post-8.jpg) center no-repeat; background-size: cover;"><span>3D相关摘记</span></a>
      
    
      
        <a href="/website/" class="recent-item" style="background: url(/assets/img/post-8.jpg) center no-repeat; background-size: cover;"><span>网址摘记</span></a>
      
    
      
        <a href="/blogaddress/" class="recent-item" style="background: url(/assets/img/post-7.jpg) center no-repeat; background-size: cover;"><span>Android优秀Blog网址</span></a>
      
    
      
        <a href="/android-jni-method/" class="recent-item" style="background: url(/assets/img/post-10.jpg) center no-repeat; background-size: cover;"><span>Android JNI—函数用法</span></a>
      
    
  </div>
</div> <!-- End Recent-Box -->

        <div class="newsletter" id="mc_embed_signup" style="display:none">
  <h2 class="newsletter-title">Newsletter</h2>
  <div class="form-container">
    <p>Subscribe here to get our latest updates</p>
    <form action="//" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
      <label class="screen-reader-text" for="mce-EMAIL">Email Address</label>
      <div class="newsletter-box" id="mc_embed_signup_scroll">
        <input type="email" name="EMAIL" placeholder="Email address" class="email-input" id="mce-EMAIL" required>
        <input type="submit" value="Subscribe" name="subscribe" class="subscribe-btn" id="mc-embedded-subscribe">
      </div>
    </form>
  </div>
</div> <!-- End Newsletter -->

        <section class="comment-area">
  <div class="comment-wrapper">
   
	  <div id="disqus_thread" class="article-comments"></div>
	    <script>
			var idcomments_acct = '1ce8d80a5f6d373a46f4ceaf3dff8859';
			var idcomments_post_id;
			var idcomments_post_url;
		</script>
		<span id="IDCommentsPostTitle" style="display:none"></span>
		<script type='text/javascript' src='https://www.intensedebate.com/js/genericCommentWrapperV2.js'></script>
	
  </div>
</section>
      </div>
    </div> <!-- End Wrapper -->
  </article>
  <div class="search-box">
  <div class="wrapper">
    <div class="search-grid">
      <form class="search-form">
        <div id="search-container">
          <input type="text" id="search-input" class="search" placeholder="Search">
        </div>
      </form>
      <ul id="results-container" class="results-search"  style="height:400px;overflow-y:scroll;overflow-y:auto;"></ul>
      <div class="icon-close-container">
        <span class="search-icon-close"><i class="fa fa-times" aria-hidden="true"></i></span>
      </div>
    </div>
  </div>
</div>

  <footer class="main-footer">
	<div class="footer-social">
		<div class="footer-container clearfix">
			<div class="social-list">
				<a class="social github" target="blank" href="https://github.com/leach-chen">GitHub</a>
				<a class="social github" target="blank" href="https://www.jianshu.com/users/5cc3aae52717/timeline">简书</a>
				<a class="social github" target="blank" href="https://juejin.im/user/581b4a3e2e958a0054d47b57/collections">掘金</a>
				<a class="social github" target="blank" href="http://blog.csdn.net/chenliqiang12345678">Csdn</a>
			</div>
		</div>
	</div>

	<div class="copyright">
		<p>2018 &copy; Leach Chen</p>
		
			
	<div style="font-size:12px;color:#B3B3B3;padding-right:30px;float:right"> 
		<iframe
                style="margin-left: 2px; margin-bottom:-5px;"
                frameborder="0" scrolling="0" width="91px" height="20px"
                src="https://ghbtns.com/github-btn.html?user=leach-chen&repo=leach-chen.github.io&type=star&count=true" >
            </iframe>
		<span id="busuanzi_container_site_pv">本站总访问量：<span id="busuanzi_value_site_pv"></span>次</span>
	</div>
	</div>

</footer> <!-- End Footer -->

</div>

  
  
<div class="top" title="Top"><i class="fa fa-chevron-up" aria-hidden="true"></i></div> <!-- End Top Scroll -->
  <!-- JS -->
<script src="/assets/js/jquery-3.2.1.min.js"></script>
<script src="/assets/js/jekyll-search.js"></script>
<script>
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('results-container'),
    json: '/search.json',
    searchResultTemplate: '<li><a href="{url}" title="{desc}">{title}</a></li>',
    noResultsText: 'No results found',
    fuzzy: false,
    exclude: ['Welcome']
  });
</script>
<script src="/assets/js/main.js"></script>

  <!--<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
